MEDIUM_SUPPORTED = cdrom

INITRD_FS = ufs

# The version of the kernel to use.
KERNELVERSION = 6.0-1-486
KERNELMAJOR = 6
KERNEL_FLAVOUR = di
KERNELNAME = kfreebsd.gz
KERNELIMAGEVERSION = $(KERNELVERSION)

# Miniature CD image using kfreebsd-loader, with only an initrd, no udebs or debs.
.PHONY: arch_miniiso
arch_miniiso: $(TEMP_INITRD) $(TEMP_KERNEL) $(TREE)
	-rm -f $(TEMP_CD_TREE)/*
	mkdir -p $(TEMP_CD_TREE)/boot/{kernel,defaults}

	cp $(TEMP_KERNEL)			$(TEMP_CD_TREE)/boot/kernel/kernel.gz
	cp $(TEMP_INITRD)			$(TEMP_CD_TREE)/boot/mfsroot.gz
	cp $(TREE)/lib/modules/*/acpi.ko	$(TEMP_CD_TREE)/boot/kernel/

	cp /boot/{cdboot,loader*,*.4th}		$(TEMP_CD_TREE)/boot/
	cp /boot/defaults/loader.conf		$(TEMP_CD_TREE)/boot/defaults/
	echo "hw.ata.atapi_dma=1"		>> $(TEMP_CD_TREE)/boot/defaults/loader.conf
	echo "mfsroot_load=\"YES\""		>> $(TEMP_CD_TREE)/boot/defaults/loader.conf
	echo "mfsroot_type=\"mfs_root\""	>> $(TEMP_CD_TREE)/boot/defaults/loader.conf
	echo "mfsroot_name=\"/boot/mfsroot\""	>> $(TEMP_CD_TREE)/boot/defaults/loader.conf

	mkisofs -r -J -b boot/cdboot -c boot.cat -no-emul-boot \
		-o $(TEMP_MINIISO) $(TEMP_CD_TREE)
